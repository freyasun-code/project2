<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Project1: Images of the Russian Empire</title>
  <style>
    body {
      background-color: #D8C3DD; /* 紫色背景 */
      font-family: Arial, sans-serif;
      color: white;
      margin: 0;
      padding: 0;
    }
    /* 导航栏 */
    nav {
      background: rgba(0, 0, 0, 0.3);
      padding: 10px 20px;
      position: sticky;
      top: 0;
      z-index: 1000;
    }
    nav a {
      color: #ffddff;
      text-decoration: none;
      margin: 0 15px;
      font-weight: bold;
    }
    nav a:hover {
      text-decoration: underline;
    }
    .container {
      width: 80%;
      margin: auto;
      padding: 20px;
    }
    h1 {
      text-align: center;
      margin-top: 20px;
    }
    .section {
      background: rgba(0,0,0,0.2);
      padding: 20px;
      margin: 40px 0;
      border-radius: 12px;
    }
    .section h2 {
      color: #ffddff;
      text-align: center;
    }
    img {
      max-width: 100%;
      border-radius: 8px;
    }
    .row {
      display: flex;
      justify-content: center;
      gap: 40px;
      margin: 20px 0;
      flex-wrap: wrap;
    }
    .img-block {
      text-align: center;
    }
    .img-block p {
      margin-top: 8px;
      font-size: 16px;
      text-align: center;
    }
    p {
      text-align: left;
      max-width: 1000px;
      margin: auto;
      margin-bottom: 20px;
      font-size: 18px;
    }
  </style>
  <!-- MathJax 支持公式渲染 -->
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
  <!-- 导航栏 -->
  <nav>
    <a href="#part1">Part1</a>
    <a href="#part2">Part2</a>
    <a href="#part3">Part3</a>
    <a href="#part4">Part4</a>
  </nav>

  <div class="container">
    <h1>Project1: Images of the Russian Empire: Colorizing the Prokudin-Gorskii photo collection</h1>
    <p style="text-align:center; font-style:italic;">Freya Sun</p>

<!-- Part 1: Fun with Filters -->
<div class="section" id="filters">
  <h2>Part 1: Fun with Filters</h2>

  <!-- Part 1.1: Convolutions from Scratch -->
  <h3 style="margin-top:20px; text-align:center;">Part 1.1: Convolutions from Scratch!</h3>

<p>
  I first implement convolution manually to build intuition about how it works. Below are two implementations: one using four nested loops and another using two loops with NumPy operations.</p>

<h3>four for loops</h3>
  <div style="display:flex; justify-content:center; margin:20px 0;">
<pre><code class="language-python">
def conv2d_four_loops(image, kernel):
    H, W = image.shape
    kH, kW = kernel.shape
    pad_h = kH // 2
    pad_w = kW // 2

    kernel = np.flipud(np.fliplr(kernel))
    # padding
    padded = np.pad(image, ((pad_h, pad_h), (pad_w, pad_w)), mode='constant')

    out = np.zeros_like(image)

    for i in range(H):
        for j in range(W):
            s = 0.0
            for m in range(kH):
                for n in range(kW):
                    s += padded[i+m, j+n] * kernel[m, n]
            out[i, j] = s
    return out
</code></pre>
</div>

<h3>two for loops</h3>
   <div style="display:flex; justify-content:center; margin:20px 0;">
<pre><code class="language-python">
def conv2d_two_loops(image, kernel):
    H, W = image.shape
    kH, kW = kernel.shape
    pad_h = kH // 2
    pad_w = kW // 2

    kernel = np.flipud(np.fliplr(kernel))
    # padding
    padded = np.pad(image, ((pad_h, pad_h), (pad_w, pad_w)), mode='constant')

    out = np.zeros_like(image)

    for i in range(H):
        for j in range(W):
            region = padded[i:i+kH, j:j+kW]
            out[i, j] = np.sum(region * kernel)
    return out
</code></pre>
</div>
  
<p style="text-align:left; max-width:800px; margin:auto; margin-bottom:20px; font-size:18px;">
When comparing with <code>scipy.signal.convolve2d</code>, we find that the convolution results are identical, confirming that our loop implementations are correct. In terms of runtime, <code>scipy.signal.convolve2d</code> is the fastest, the two-loop version is slightly slower, and the four-loop version is the slowest. Regarding boundary handling, both of our implementations use zero padding, while <code>convolve2d</code> provides multiple options for handling boundaries. In this experiment, we also chose zero padding for consistency.
</p>

<!-- 5 张图分两行 -->
<div style="display: flex; justify-content: center; gap:30px; flex-wrap: wrap; margin-top:20px;">
  <!-- 第一行：2 张 -->
  <div style="flex: 0 0 200px; text-align: center;">
    <img src="original_gray.jpg" alt="Original Gray" width="200">
    <p>Original (Gray)</p>
  </div>
  <div style="flex: 0 0 200px; text-align: center;">
    <img src="blurred_box9.jpg" alt="Blurred Box Filter" width="200">
    <p>Blurred (9x9 Box Filter)</p>
  </div>

  <!-- 第二行：3 张 -->
  <div style="flex: 0 0 200px; text-align: center;">
    <img src="edge_dx.jpg" alt="Edge Dx" width="200">
    <p>Edge Dx</p>
  </div>
  <div style="flex: 0 0 200px; text-align: center;">
    <img src="edge_dy.jpg" alt="Edge Dy" width="200">
    <p>Edge Dy</p>
  </div>
  <div style="flex: 0 0 200px; text-align: center;">
    <img src="edge_combined.jpg" alt="Edge Combined" width="200">
    <p>Edges (Combined Magnitude)</p>
  </div>
</div>

  <!-- Part 1.2: Finite Difference Operator -->
<h3 style="margin-top:40px; text-align:center;">Part 1.2: Finite Difference Operator</h3>
<p style="text-align:left; max-width:800px; margin:auto; margin-bottom:20px; font-size:18px;">
  By applying Dx and Dy, I was able to approximate the gradient of the image in horizontal and vertical directions. 
  The goal was to suppress most of the noise while still preserving all the meaningful edges. I chose a threshold value of 80 which was done qualitatively by trying different values and observing the results. 
</p>

<!-- 四张图并排 -->
<div style="display: flex; justify-content: center; gap:40px; margin-top:20px;">
  <figure style="text-align:center; margin:0;">
    <img src="Ix.jpg" alt="Ix" width="220">
    <figcaption>Ix (∂I/∂x)</figcaption>
  </figure>
  <figure style="text-align:center; margin:0;">
    <img src="Iy.jpg" alt="Iy" width="220">
    <figcaption>Iy (∂I/∂y)</figcaption>
  </figure>
  <figure style="text-align:center; margin:0;">
    <img src="grad_mag.jpg" alt="Gradient Magnitude" width="220">
    <figcaption>Gradient Magnitude</figcaption>
  </figure>
  <figure style="text-align:center; margin:0;">
    <img src="edge_img.jpg" alt="Edge Image" width="220">
    <figcaption>Edge Image (Thresholded)</figcaption>
  </figure>
</div>




<!-- Part 1.3: Derivative of Gaussian (DoG) Filter -->
<h3 style="margin-top:40px; text-align:center;">Part 1.3: Derivative of Gaussian (DoG) Filter</h3>
<p style="text-align:left; max-width:800px; margin:auto; margin-bottom:20px; font-size:18px;">
  I constructed Gaussian filters using the function `cv2.getGaussianKernel`, and then built Difference of Gaussian (DoG) filters. Gaussian smoothing and difference operator had the same result as DoG.

Comparing these results with the finite difference method, the Gaussian smoothing and DoG filter produced cleaner and more structured edges, since Gaussian smoothing suppresses noise before detecting edges. 
</p>

<!-- 图片展示区域 -->
<div style="display:flex; justify-content:center; flex-wrap:wrap; gap:30px; max-width:1000px; margin:auto;">

  <!-- 第一行三张 -->
  <div style="text-align:center; width:250px;">
    <img src="Blur.jpg" alt="Blur" style="width:250px; border:1px solid #ccc; border-radius:8px;">
    <div style="margin-top:8px; font-size:16px;">Blur</div>
  </div>

  <div style="text-align:center; width:250px;">
    <img src="Ix_blur.jpg" alt="Ix (Blurred)" style="width:250px; border:1px solid #ccc; border-radius:8px;">
    <div style="margin-top:8px; font-size:16px;">Ix (Blurred)</div>
  </div>

  <div style="text-align:center; width:250px;">
    <img src="Iy_blur.jpg" alt="Iy (Blurred)" style="width:250px; border:1px solid #ccc; border-radius:8px;">
    <div style="margin-top:8px; font-size:16px;">Iy (Blurred)</div>
  </div>

  <!-- 第二行两张 -->
  <div style="text-align:center; width:250px;">
    <img src="GradMag_blur.jpg" alt="Grad Mag (Blurred)" style="width:250px; border:1px solid #ccc; border-radius:8px;">
    <div style="margin-top:8px; font-size:16px;">Grad Mag (Blurred)</div>
  </div>

  <div style="text-align:center; width:250px;">
    <img src="GradMag_DoG.jpg" alt="Grad Mag (DoG)" style="width:250px; border:1px solid #ccc; border-radius:8px;">
    <div style="margin-top:8px; font-size:16px;">Grad Mag (DoG)</div>
  </div>

</div>

<!-- Part 2: Fun with Frequencies! -->
<h2 style="margin-top:50px; text-align:center;">Part 2: Fun with Frequencies!</h2>

<!-- Part 2.1: Image "Sharpening" -->
<h3 style="margin-top:30px; text-align:center;">Part 2.1: Image "Sharpening"</h3>
<p style="text-align:left; max-width:800px; margin:auto; margin-bottom:20px; font-size:18px;">
  Unsharp masking sharpens an image by combining blur filtering with high frequencies. A Gaussian blur removes high-frequency details, and subtracting this blurred image from the original isolates the high-frequency components (edges and fine details). Adding these back produces the sharpened result.

On the Taj Mahal image, the blurred version looks smoother, the high-frequency image shows edges, and the sharpened image enhances detail and contrast. Small factors give subtle sharpening, while large ones produce strong edges but may introduce artifacts.
</p>

<!-- 三张图并排 -->
<div style="display:flex; justify-content:center; gap:30px; flex-wrap:wrap; max-width:1000px; margin:auto;">

  <div style="text-align:center; width:250px;">
    <img src="Blurred_Gaussian.jpg" alt="Blurred (Gaussian)" style="width:250px; border:1px solid #ccc; border-radius:8px;">
    <div style="margin-top:8px; font-size:16px;">Blurred (Gaussian)</div>
  </div>

  <div style="text-align:center; width:250px;">
    <img src="High_Frequencies1.3.jpg" alt="High Frequencies" style="width:250px; border:1px solid #ccc; border-radius:8px;">
    <div style="margin-top:8px; font-size:16px;">High Frequencies</div>
  </div>

  <div style="text-align:center; width:250px;">
    <img src="Sharpened.jpg" alt="Sharpened" style="width:250px; border:1px solid #ccc; border-radius:8px;">
    <div style="margin-top:8px; font-size:16px;">Sharpened</div>
  </div>

</div>
<!-- My Image Section -->
<h3 style="margin-top:40px; text-align:left;">My image</h3>

<!-- 图片展示区域 -->
<div style="display:flex; justify-content:center; gap:30px; flex-wrap:wrap; max-width:1100px; margin:auto;">

<div style="text-align:center; width:200px;">
  <img src="myimg.jpg" alt="Original" style="width:200px; border:1px solid #ccc; border-radius:8px;">
  <div style="margin-top:8px; font-size:16px;">Original</div>
</div>

<div style="text-align:center; width:200px;">
  <img src="myBlurred_Gaussian.jpg" alt="Blurred (Gaussian)" style="width:200px; border:1px solid #ccc; border-radius:8px;">
  <div style="margin-top:8px; font-size:16px;">Blurred (Gaussian)</div>
</div>

<div style="text-align:center; width:200px;">
  <img src="myHigh_Frequencies.jpg" alt="High Frequencies" style="width:200px; border:1px solid #ccc; border-radius:8px;">
  <div style="margin-top:8px; font-size:16px;">High Frequencies</div>
</div>

<div style="text-align:center; width:200px;">
  <img src="mySharpened.jpg" alt="Sharpened" style="width:200px; border:1px solid #ccc; border-radius:8px;">
  <div style="margin-top:8px; font-size:16px;">Sharpened</div>
</div>


</div>

<h2>Part 2.2: Hybrid Images</h2>

<p>
In this part, we create hybrid images by combining the high-frequency components of one image with the low-frequency components of another. The process involves aligning the input images, extracting the respective frequency components using Gaussian filtering, and then summing them to produce the final hybrid image. To better understand the frequency content at each stage, we also show the log-magnitude of the Fourier transforms for the input images, the filtered images, and the final hybrid image.
</p>

<!-- 第一行：原图1 → 对齐1 → FFT1 -->
<div style="text-align:center; margin-bottom: 20px;">
    <figure style="display:inline-block; margin:0 10px;">
        <img src="Original_Image_1_Highfreq.jpg" width="200"><br>
        <figcaption>Original Image 1</figcaption>
    </figure>
    <span style="font-size:30px; vertical-align:middle;">&#8594;</span>
    <figure style="display:inline-block; margin:0 10px;">
        <img src="Aligned_Image_1.jpg" width="200"><br>
        <figcaption>Aligned Image 1</figcaption>
    </figure>
    <span style="font-size:30px; vertical-align:middle;">&#8594;</span>
    <figure style="display:inline-block; margin:0 10px;">
        <img src="FFT_Input_Image_1.jpg" width="200"><br>
        <figcaption>FFT Image 1</figcaption>
    </figure>
</div>

<!-- 第二行：原图2 → 对齐2 → FFT2 -->
<div style="text-align:center; margin-bottom: 20px;">
    <figure style="display:inline-block; margin:0 10px;">
        <img src="Original_Image_2_Lowfreq.jpg" width="200"><br>
        <figcaption>Original Image 2</figcaption>
    </figure>
    <span style="font-size:30px; vertical-align:middle;">&#8594;</span>
    <figure style="display:inline-block; margin:0 10px;">
        <img src="Aligned_Image_2.jpg" width="200"><br>
        <figcaption>Aligned Image 2</figcaption>
    </figure>
    <span style="font-size:30px; vertical-align:middle;">&#8594;</span>
    <figure style="display:inline-block; margin:0 10px;">
        <img src="FFT_Input_Image_2.jpg" width="200"><br>
        <figcaption>FFT Image 2</figcaption>
    </figure>
</div>

<!-- 第三行：高频 + 低频 = 合成 -->
<div style="text-align:center; margin-bottom: 20px;">
    <figure style="display:inline-block; margin:0 10px;">
        <img src="High_Frequencies2.2.jpg" width="200"><br>
        <figcaption>High Frequencies</figcaption>
    </figure>
    <span style="font-size:30px; vertical-align:middle;">+</span>
    <figure style="display:inline-block; margin:0 10px;">
        <img src="Low_Frequencies.jpg" width="200"><br>
        <figcaption>Low Frequencies</figcaption>
    </figure>
    <span style="font-size:30px; vertical-align:middle;">=</span>
    <figure style="display:inline-block; margin:0 10px;">
        <img src="Hybrid_Image_sigma8_10.jpg" width="200"><br>
        <figcaption>Hybrid Image</figcaption>
    </figure>
</div>

<!-- 第四行：FFT 高频 + FFT 低频 = FFT 合成 -->
<div style="text-align:center; margin-bottom: 20px;">
    <figure style="display:inline-block; margin:0 10px;">
        <img src="FFT_High_Frequencies.jpg" width="200"><br>
        <figcaption>FFT High Frequencies</figcaption>
    </figure>
    <span style="font-size:30px; vertical-align:middle;">+</span>
    <figure style="display:inline-block; margin:0 10px;">
        <img src="FFT_Low_Frequencies.jpg" width="200"><br>
        <figcaption>FFT Low Frequencies</figcaption>
    </figure>
    <span style="font-size:30px; vertical-align:middle;">=</span>
    <figure style="display:inline-block; margin:0 10px;">
        <img src="FFT_Hybrid_sigma8_10.jpg" width="200"><br>
        <figcaption>FFT Hybrid Image</figcaption>
    </figure>
</div>
  
<!-- My image -->
<h3 style="margin-top:40px; text-align:left;">My image</h3>
<div style="display:flex; align-items:center; justify-content:center; gap:10px;">

    <!-- First Image -->
    <figure style="margin:0; text-align:center;">
        <img src="idle.jpg" alt="Idle" width="200">
        <figcaption style="margin-top:5px;">Idle</figcaption>
    </figure>

    <!-- Plus -->
    <div style="font-size:24px; display:flex; align-items:center; justify-content:center;">+</div>

    <!-- Second Image -->
    <figure style="margin:0; text-align:center;">
        <img src="pig.jpg" alt="Pig" width="200">
        <figcaption style="margin-top:5px;">Pig</figcaption>
    </figure>

    <!-- Equal -->
    <div style="font-size:24px; display:flex; align-items:center; justify-content:center;">=</div>

    <!-- Blended -->
    <figure style="margin:0; text-align:center;">
        <img src="Hybrid_Color_sigma16_10_cropped.jpg" alt="Blended" width="200">
        <figcaption style="margin-top:5px;">Blended</figcaption>
    </figure>

</div>
  
<h2>Part 2.3 & 2.4: Multiresolution Blending (a.k.a. the oraple!)</h2>

<div class="description">
    <p>
        In this part, I blended an apple and an orange using <strong>multiresolution blending</strong>. 
        I made a <strong>smooth Gaussian mask</strong> to separate the left and right sides, and I built a <strong>Laplacian pyramid</strong> to extract different frequency bands. 
        By combining high-frequency and low-frequency details layer by layer, I could smoothly merge the two images. 
        Finally, the apple and orange are successfully fused with natural colors and smooth transitions!
    </p>
</div>

<!-- L0 Layer -->
<div style="display:flex; justify-content:center; align-items:center; gap:10px; margin-bottom:20px;">
    <figure style="margin:0; text-align:center;">
        <img src="Apple_L0.jpg" alt="Apple L0" width="200">
        <figcaption style="margin-top:5px;">Apple L0</figcaption>
    </figure>
    <div style="font-size:24px; display:flex; align-items:center; justify-content:center;">+</div>
    <figure style="margin:0; text-align:center;">
        <img src="Orange_L0.jpg" alt="Orange L0" width="200">
        <figcaption style="margin-top:5px;">Orange L0</figcaption>
    </figure>
    <div style="font-size:24px; display:flex; align-items:center; justify-content:center;">=</div>
    <figure style="margin:0; text-align:center;">
        <img src="Blend_L0.jpg" alt="Blend L0" width="200">
        <figcaption style="margin-top:5px;">Blend L0</figcaption>
    </figure>
</div>

<!-- L2 Layer -->
<div style="display:flex; justify-content:center; align-items:center; gap:10px; margin-bottom:20px;">
    <figure style="margin:0; text-align:center;">
        <img src="Apple_L2.jpg" alt="Apple L2" width="200">
        <figcaption style="margin-top:5px;">Apple L2</figcaption>
    </figure>
    <div style="font-size:24px; display:flex; align-items:center; justify-content:center;">+</div>
    <figure style="margin:0; text-align:center;">
        <img src="Orange_L2.jpg" alt="Orange L2" width="200">
        <figcaption style="margin-top:5px;">Orange L2</figcaption>
    </figure>
    <div style="font-size:24px; display:flex; align-items:center; justify-content:center;">=</div>
    <figure style="margin:0; text-align:center;">
        <img src="Blend_L2.jpg" alt="Blend L2" width="200">
        <figcaption style="margin-top:5px;">Blend L2</figcaption>
    </figure>
</div>

<!-- L4 Layer -->
<div style="display:flex; justify-content:center; align-items:center; gap:10px; margin-bottom:20px;">
    <figure style="margin:0; text-align:center;">
        <img src="Apple_L4.jpg" alt="Apple L4" width="200">
        <figcaption style="margin-top:5px;">Apple L4</figcaption>
    </figure>
    <div style="font-size:24px; display:flex; align-items:center; justify-content:center;">+</div>
    <figure style="margin:0; text-align:center;">
        <img src="Orange_L4.jpg" alt="Orange L4" width="200">
        <figcaption style="margin-top:5px;">Orange L4</figcaption>
    </figure>
    <div style="font-size:24px; display:flex; align-items:center; justify-content:center;">=</div>
    <figure style="margin:0; text-align:center;">
        <img src="Blend_L4.jpg" alt="Blend L4" width="200">
        <figcaption style="margin-top:5px;">Blend L4</figcaption>
    </figure>
</div>

<!-- Original Masked + Final Blend -->
<div style="display:flex; justify-content:center; align-items:center; gap:10px; margin-bottom:20px;">
    <figure style="margin:0; text-align:center;">
        <img src="Apple_masked.png" alt="Apple Masked" width="200">
        <figcaption style="margin-top:5px;">Apple * Mask</figcaption>
    </figure>
    <div style="font-size:24px; display:flex; align-items:center; justify-content:center;">+</div>
    <figure style="margin:0; text-align:center;">
        <img src="Orange_masked.png" alt="Orange Masked" width="200">
        <figcaption style="margin-top:5px;">Orange * (1-Mask)</figcaption>
    </figure>
    <div style="font-size:24px; display:flex; align-items:center; justify-content:center;">=</div>
    <figure style="margin:0; text-align:center;">
        <img src="Final_blend.png" alt="Final Blend" width="200">
        <figcaption style="margin-top:5px;">Final Blend</figcaption>
    </figure>
</div>

<!-- My image -->
<h3 style="margin-top:40px; text-align:left;">My image</h3>
<div style="display:flex; justify-content:center; align-items:center; gap:10px; margin-bottom:20px;">
    <figure style="margin:0; text-align:center;">
        <img src="hamburger.jpg" alt="Hamburger" width="200">
        <figcaption style="margin-top:5px;">Hamburger</figcaption>
    </figure>
    <div style="font-size:24px; display:flex; align-items:center; justify-content:center;">+</div>
    <figure style="margin:0; text-align:center;">
        <img src="pizza.jpg" alt="Pizza" width="200">
        <figcaption style="margin-top:5px;">Pizza</figcaption>
    </figure>
    <div style="font-size:24px; display:flex; align-items:center; justify-content:center;">=</div>
    <figure style="margin:0; text-align:center;">
        <img src="Hamburger_Pizza_blend.jpg" alt="Hamburger + Pizza Blend" width="200">
        <figcaption style="margin-top:5px;">Hamburger + Pizza Blend</figcaption>
    </figure>
</div>

<!-- Cry + Coffee + Blended -->
<div style="display:flex; justify-content:center; align-items:center; gap:10px; margin-bottom:20px;">
    <figure style="margin:0; text-align:center;">
        <img src="cry.jpg" alt="Cry" width="200">
        <figcaption style="margin-top:5px;">Cry</figcaption>
    </figure>
    <div style="font-size:24px; display:flex; align-items:center; justify-content:center;">+</div>
    <figure style="margin:0; text-align:center;">
        <img src="coffee.jpg" alt="Coffee" width="200">
        <figcaption style="margin-top:5px;">Coffee</figcaption>
    </figure>
    <div style="font-size:24px; display:flex; align-items:center; justify-content:center;">=</div>
    <figure style="margin:0; text-align:center;">
        <img src="Cry_Coffee_Blended.jpg" alt="Blended" width="200">
        <figcaption style="margin-top:5px;">Blended</figcaption>
    </figure>
</div>

</div>
